{% extends "base.html" %}

{% block title %}
	Run Shell | Our World of Text
{% endblock %}

{% block header %}
	<h1>Run Shell</h1>
	<span><a href="/administrator/">Â« Back to Admin Panel</a></span>
	<style>
		#shell_console {
			border: 1px solid black;
			width: 100%;
			height: 500px;
			background-color: white;
			font-family: "Courier New", monospace;
			overflow-y: scroll;
			white-space: pre;
		}
	</style>
{% endblock %}

{% block content %}
	<div style="width: 1000px; border: 1px solid black; background-color: rgb(190, 190, 190);">
		<button id="load_shell_cont">Load shell.js content</button>
		<button id="exec_shell">Execute script</button>
		<button id="console_down">Move down</button>
		<button id="console_clr">Clear console</button>
		<br>
		<span>Output:</span>
		<div id="shell_console"></div>
	</div>
{% endblock %}

{% block endbody %}
<script>
	function printShell(str) {
		shell_console.innerText += str + "\n";
	}
	load_shell_cont.onclick = function() {
		printShell("Loading script content...");
		ajaxRequest({
			type: "GET",
			url: "/administrator/shell/",
			data: {
				command: "load"
			},
			done: function(data) {
				printShell(data);
			},
			error: function(req) {
				if(req.status == 404) {
					printShell("The shell script does not exist (./data/shell.js)");
				} else {
					printShell("HTTP Error (" + req.status + "): " + req.responseText);
				}
			}
		});
	}
	exec_shell.onclick = function() {
		printShell("Executing script...");
		ajaxRequest({
			type: "POST",
			url: "/administrator/shell/",
			data: {
				command: "exec"
			},
			done: function(data) {
				printShell("Result:\n" + data);
			},
			error: function(req) {
				if(req.status == 400) {
					printShell("Invalid request");
				}
				if(req.status == 500) {
					printShell("Error executing script:\n" + req.responseText);
				}
			}
		});
	}
	console_down.onclick = function() {
		shell_console.scrollTop = shell_console.scrollHeight;
	}
	console_clr.onclick = function() {
		shell_console.innerText = "";
	}
</script>

<!-- Pull ajaxRequest from here -->
<script type="text/javascript" src="/static/autocomplete.js"></script>
{% endblock %}